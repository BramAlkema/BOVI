<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BOVI Framework ‚Äî Educational Money App</title>
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="src/styles/variables.css">
  <link rel="stylesheet" href="src/styles/base.css">
  <link rel="stylesheet" href="src/styles/components.css">
  <link rel="stylesheet" href="src/styles/scenarios.css">
  
  <!-- Custom styles for mode breakdown cards -->
  <style>
    .mode-breakdown-card {
      padding: var(--space-md);
      border-radius: var(--space-sm);
      margin: var(--space-sm) 0;
      border-left: 4px solid;
    }
    
    .mode-breakdown-card.balanced { 
      border-left-color: var(--balanced);
      background: rgba(76,201,240,.05);
    }
    .mode-breakdown-card.obligated { 
      border-left-color: var(--obligated);
      background: rgba(255,107,107,.05);
    }
    .mode-breakdown-card.value { 
      border-left-color: var(--value);
      background: rgba(161,255,181,.05);
    }
    .mode-breakdown-card.immediate { 
      border-left-color: var(--immediate);
      background: rgba(255,209,102,.05);
    }
    
    .mode-breakdown-card.primary {
      border-left-width: 6px;
      background: rgba(255,255,255,.08);
    }
    
    .mode-header {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-xs);
    }
    
    .insights-list {
      list-style: none;
      padding: 0;
      margin: var(--space-sm) 0;
    }
    
    .insights-list li {
      margin: var(--space-xs) 0;
      padding-left: var(--space-lg);
      position: relative;
    }
    
    .insights-list li::before {
      content: 'üí°';
      position: absolute;
      left: 0;
      top: 0;
    }

    /* Studio container styles */
    .studio-container {
      margin-top: var(--space-md);
      border-radius: var(--space-sm);
      overflow: hidden;
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M12 2L2 7l10 5 10-5-10-5z" stroke="#0b0f14" stroke-width="2" stroke-linejoin="round"/>
        <path d="m2 17 10 5 10-5M2 12l10 5 10-5" stroke="#0b0f14" stroke-width="2" stroke-linejoin="round"/>
      </svg>
    </div>
    <div>
      <h1>BOVI Framework</h1>
      <div class="sub">Educational app: Balanced ‚Ä¢ Obligated ‚Ä¢ Value ‚Ä¢ Immediate ‚Äî Four fairness modes of money</div>
    </div>
    <div class="right row">
      <span class="chip" id="aiChip" aria-live="polite" title="AI Butler defaults decisions to the fair option if you do nothing">ü§ñ AI Butler: <b id="aiState">ON</b></span>
      <button class="btn ghost" id="toggleAI">Toggle</button>
    </div>
  </header>

  <div class="frame">
    <nav>
      <button class="tab" data-tab="overview" aria-current="page">üè† Overview</button>
      <button class="tab" data-tab="balanced">‚öñÔ∏è Balanced</button>
      <button class="tab" data-tab="obligated">üëë Obligated</button>
      <button class="tab" data-tab="value">üí± Value</button>
      <button class="tab" data-tab="immediate">ü§ù Immediate</button>
      <button class="tab" data-tab="scenarios">üé≠ Scenarios</button>
      <button class="tab" data-tab="bundle">üì¶ Bundle</button>
      <button class="tab" data-tab="groceries">üõí Groceries</button>
      <button class="tab" data-tab="rent">üè† Rent</button>
      <button class="tab" data-tab="energy">‚ö° Energy</button>
    </nav>

    <main>
      <!-- Overview Section -->
      <section id="overview" class="stack">
        <div class="panel">
          <h2>The BOVI Framework</h2>
          <p class="text-muted">Money isn't a single invention‚Äîit's a bundle of four fairness modes that humans use to structure exchange. Each mode maps to Alan Fiske's relational models and solves different trade problems.</p>
          
          <div class="grid">
            <div class="card">
              <span class="mode-badge balanced">B</span>
              <h4>Balanced (Equality Matching)</h4>
              <p class="text-small">Fairness as symmetry. Ledgers, tallies, keeping score across time. Everyone gets their turn, debts must be squared.</p>
            </div>
            <div class="card">
              <span class="mode-badge obligated">O</span>
              <h4>Obligated (Authority Ranking)</h4>
              <p class="text-small">Fairness as compliance with hierarchy. You owe taxes, rent, tribute. Money as political infrastructure.</p>
            </div>
            <div class="card">
              <span class="mode-badge value">V</span>
              <h4>Value (Market Pricing)</h4>
              <p class="text-small">Fairness as proportionality. Transferable medium where units are interchangeable. Minimal money.</p>
            </div>
            <div class="card">
              <span class="mode-badge immediate">I</span>
              <h4>Immediate (Communal Sharing)</h4>
              <p class="text-small">Fairness as direct equivalence. Tit-for-tat swaps. Anchors our visceral fairness instinct.</p>
            </div>
          </div>
        </div>

        <div class="panel">
          <h3>Core Insight</h3>
          <p>Competing "origin stories" of money aren't contradictory‚Äîthey each reflect one fairness mode. The BOVI bundle explains why money reforms spark moral outrage: each mode plugs into a deep fairness instinct.</p>
          <div class="row">
            <span class="chip">Many origins, one bundle</span>
            <span class="chip">Fairness modes bundled together</span>
            <span class="chip">Reform requires understanding all modes</span>
          </div>
        </div>

        <div class="panel">
          <h3>Hybrid System Status</h3>
          <div class="grid">
            <div class="kpi">
              <div>
                <div class="text-muted text-small">Flow DSL flows loaded</div>
                <div class="text-large" id="flowsLoaded">0</div>
              </div>
              <span class="chip">JSON flows</span>
            </div>
            <div class="kpi">
              <div>
                <div class="text-muted text-small">AI Butler defaults</div>
                <div class="text-large" id="defaultsKPI">0</div>
              </div>
              <span class="chip">Auto-applied</span>
            </div>
            <div class="kpi">
              <div>
                <div class="text-muted text-small">Events processed</div>
                <div class="text-large" id="eventsProcessed">0</div>
              </div>
              <span class="chip">BOVI events</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Groceries Section -->
      <section id="groceries" class="stack" hidden>
        <div class="panel">
          <h2 id="hGro">üõí Groceries ‚Äî Scan basket</h2>
          <p class="text-muted">See nominal ‚Ç¨, real ‚Ç¨LTS, and a deal-quality signal. If AI Butler is ON, a suggested swap will auto-apply after a short countdown unless you cancel.</p>
          <div class="row">
            <button class="btn brand" id="scanBtn">Scan demo basket</button>
            <span class="chip">Base year: <span id="baseYear">2020</span></span>
            <span class="chip">Personal index: <span id="piLabel">Food‚Äëheavy</span></span>
          </div>
          <div class="divider"></div>
          <div class="list" id="basketList" aria-live="polite"></div>
          <div class="divider"></div>
          <div class="row">
            <div class="chip">Nominal total: <b id="nomTotal">‚Ç¨0.00</b></div>
            <div class="chip">Real total (‚Ç¨LTS): <b id="realTotal">‚Ç¨LTS 0.00</b></div>
            <div class="chip">Deal quality: <b id="dealQuality">‚Äî</b></div>
          </div>
        </div>

        <div class="panel" id="groAction" hidden>
          <div class="row">
            <h3 class="right" style="margin:0">Suggested action</h3>
          </div>
          <p class="text-muted">Shrinkflation detected on pasta. Default is to swap back to your usual brand unless you cancel.</p>
          <div class="row">
            <span class="countdown" id="groceryCountdown" aria-live="polite">Auto‚Äëapply in 10s</span>
            <span class="right">
              <button class="btn" id="cancelSwap">Cancel</button>
              <button class="btn brand" id="applySwap">Apply now</button>
            </span>
          </div>
        </div>

        <!-- Flow Visualization Studio -->
        <div class="panel">
          <h3>Flow Visualization</h3>
          <div id="groceriesStudio" class="studio-container"></div>
        </div>
      </section>

      <!-- Rent Section -->
      <section id="rent" class="stack" hidden>
        <div class="panel">
          <h2 id="hRent">üè† Rent ‚Äî Negotiate increase</h2>
          <p class="text-muted">Compare the landlord's nominal rise to your real costs. If you do nothing, the AI butler will submit a fair counter based on your personal index.</p>
          <div class="grid">
            <div class="card">
              <label>Current monthly rent (‚Ç¨)</label>
              <input type="number" id="rentCurrent" value="1200" min="0" step="10"/>
            </div>
            <div class="card">
              <label>Proposed increase (%)</label>
              <input type="number" id="rentProposed" value="5" min="0" step="0.1"/>
            </div>
            <div class="card">
              <label>Your personal cost index (YoY, %)</label>
              <input type="number" id="rentIndex" value="2.2" min="0" step="0.1"/>
            </div>
          </div>
          <div class="divider"></div>
          <div class="row">
            <span class="chip">Landlord asks: <b id="rentAsk">‚Ç¨1,260</b></span>
            <span class="chip">Fair counter (index‚Äëaligned): <b id="rentFair">‚Ç¨1,226</b></span>
            <span class="chip warn">Gap: <b id="rentGap">‚Ç¨34</b></span>
          </div>
        </div>
        <div class="panel">
          <div class="row">
            <span class="text-muted">Default action: submit counter‚Äëoffer unless you override.</span>
            <span class="right">
              <span class="countdown" id="rentCountdown" aria-live="polite">Auto‚Äësubmit in 10s</span>
              <button class="btn" id="rentCancel">Cancel</button>
              <button class="btn brand" id="rentSubmit">Submit now</button>
            </span>
          </div>
        </div>

        <!-- Flow Visualization Studio -->
        <div class="panel">
          <h3>Flow Visualization</h3>
          <div id="rentStudio" class="studio-container"></div>
        </div>
      </section>

      <!-- Energy Section -->
      <section id="energy" class="stack" hidden>
        <div class="panel">
          <h2 id="hEn">‚ö° Energy ‚Äî Cohort switching</h2>
          <p class="text-muted">If your tariff drifts above the cohort baseline, the default is to enrol you in the next group switch (you can opt out).</p>
          <div class="grid">
            <div class="card">
              <label>Your current tariff (‚Ç¨/month)</label>
              <input type="number" id="tariff" value="92" min="0" step="1"/>
            </div>
            <div class="card">
              <label>Cohort baseline (‚Ç¨/month)</label>
              <input type="number" id="baseline" value="78" min="0" step="1"/>
            </div>
            <div class="card">
              <label>Enrolment deadline</label>
              <input type="text" id="deadline" value="Friday 18:00" />
            </div>
          </div>
          <div class="divider"></div>
          <div class="row">
            <span class="chip">Excess vs baseline: <b id="excess">‚Ç¨14</b></span>
            <span class="chip">Annualised saving if switched: <b id="saving">‚Ç¨168</b></span>
          </div>
        </div>
        <div class="panel">
          <div class="row">
            <span class="text-muted">Default action: enrol you in the cohort if you do nothing.</span>
            <span class="right">
              <span class="countdown" id="energyCountdown" aria-live="polite">Auto‚Äëenrol in 10s</span>
              <button class="btn" id="energyCancel">Cancel</button>
              <button class="btn brand" id="energyEnrol">Enrol now</button>
            </span>
          </div>
        </div>

        <!-- Flow Visualization Studio -->
        <div class="panel">
          <h3>Flow Visualization</h3>
          <div id="energyStudio" class="studio-container"></div>
        </div>
      </section>

      <!-- Balanced Section -->
      <section id="balanced" class="stack" hidden>
        <div class="panel">
          <h2><span class="mode-badge balanced">B</span> Balanced ‚Äî Keeping Score</h2>
          <p class="text-muted"><strong>Fiske Mode:</strong> Equality Matching ‚Äî fairness as symmetry, everyone gets their turn</p>
          
          <div class="card">
            <h4>Economic Argument</h4>
            <p>Fairness across time requires records‚Äîledgers, tallies, or common knowledge. Periodic settling slashes transaction costs compared to constant barter.</p>
          </div>

          <div class="grid">
            <div class="card">
              <h4>Key Features</h4>
              <ul class="text-small">
                <li>Known money supply = distributed ledger</li>
                <li>Society's collective memory of fairness</li>
                <li>Counterfeiting despised (falsifies records)</li>
                <li>Periodic settlement reduces costs</li>
              </ul>
            </div>
            <div class="card">
              <h4>Historical Example</h4>
              <p class="text-small"><strong>Tally sticks in medieval England</strong><br>
              Split wooden sticks recorded debts. Both parties kept half, ensuring accurate records and preventing fraud.</p>
            </div>
          </div>
        </div>

        <div class="panel">
          <h3>Interactive Demo: Tally System</h3>
          <div class="scenario balanced" data-demo="tally" data-container="#tallyResult">
            <div class="row">
              <div>
                <strong>Village Tally Network</strong>
                <p class="text-small text-muted">See how medieval villagers used split sticks to track debts and maintain fairness over time</p>
              </div>
              <span class="btn">Run Demo</span>
            </div>
          </div>
          <div id="tallyResult" class="card" hidden></div>
        </div>
      </section>

      <!-- Scenarios Section -->
      <section id="scenarios" class="stack" hidden>
        <div class="panel">
          <h2>Real-World Scenarios</h2>
          <p class="text-muted">Explore how different fairness modes play out in everyday situations. Click scenarios to see the BOVI analysis.</p>
          
          <div class="grid">
            <div class="scenario balanced" data-scenario="rent">
              <span class="mode-badge balanced">B</span>
              <h4>Rent Collection</h4>
              <p class="text-small">Monthly payments create a balanced ledger between tenant and landlord over time.</p>
            </div>
            
            <div class="scenario obligated" data-scenario="tax">
              <span class="mode-badge obligated">O</span>
              <h4>Tax Season</h4>
              <p class="text-small">Government requires payment in official currency, driving demand through authority.</p>
            </div>
            
            <div class="scenario value" data-scenario="market">
              <span class="mode-badge value">V</span>
              <h4>Farmers Market</h4>
              <p class="text-small">Cash enables proportional exchange between diverse goods and services.</p>
            </div>
            
            <div class="scenario immediate" data-scenario="favor">
              <span class="mode-badge immediate">I</span>
              <h4>Neighborhood Favors</h4>
              <p class="text-small">Direct reciprocity: "I'll watch your kids if you fix my fence."</p>
            </div>

            <div class="scenario value" data-scenario="grocery">
              <span class="mode-badge value">V</span>
              <h4>Grocery Shopping</h4>
              <p class="text-small">Supermarket transactions show Value mode efficiency versus other fairness intuitions.</p>
            </div>
          </div>
        </div>

        <div id="scenarioResult" class="panel" hidden>
          <!-- Scenario analysis will be injected here -->
        </div>
      </section>

      <!-- Placeholder sections for other modes -->
      <section id="obligated" class="stack" hidden>
        <div class="panel">
          <h2><span class="mode-badge obligated">O</span> Obligated ‚Äî Enforced Payments</h2>
          <p class="text-muted">Coming soon: Authority Ranking mode analysis and demos</p>
        </div>
      </section>

      <section id="value" class="stack" hidden>
        <div class="panel">
          <h2><span class="mode-badge value">V</span> Value ‚Äî Minimal Money</h2>
          <p class="text-muted">Coming soon: Market Pricing mode analysis and demos</p>
        </div>
      </section>

      <section id="immediate" class="stack" hidden>
        <div class="panel">
          <h2><span class="mode-badge immediate">I</span> Immediate ‚Äî Tit-for-Tat</h2>
          <p class="text-muted">Coming soon: Communal Sharing mode analysis and demos</p>
        </div>
      </section>

      <section id="bundle" class="stack" hidden>
        <div class="panel">
          <h2>The Bundle Effect</h2>
          <p class="text-muted">Coming soon: Understanding how modes layer together in modern money systems</p>
        </div>
      </section>
    </main>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>
</div>

<!-- Legacy Application JavaScript -->
<script type="module" src="src/scripts/app.js"></script>

<!-- New Hybrid System -->
<script type="module" src="lib/integration.ts"></script>

<script>
// Update event counter for demo
let eventCount = 0;
document.addEventListener('*', () => {
  eventCount++;
  const el = document.getElementById('eventsProcessed');
  if (el) el.textContent = eventCount.toString();
});

// Update flows loaded counter
setTimeout(() => {
  const el = document.getElementById('flowsLoaded');
  if (el) el.textContent = '3'; // groceries, rent, energy
}, 1000);
</script>
</body>
</html>